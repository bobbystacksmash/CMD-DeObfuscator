* DOS De-Obfuscator

** ABOUT

/Currently under active development/

The ~DOS DeObfuscator~ is a pure JavaScript library written to
deobfuscate commands passed to ~CMD.EXE~, presenting malicious
commands free of "noise", without needing a Windows system.

** EXAMPLES
*** Variable find/replace
Replaces all occurances of ~cmd~ inside the ~%COMSPEC%~ var with the
string ~powershell~:
#+BEGIN_SRC javascript
deobfuscate("%COMSPEC:cmd=powershell%"); // => C:\Windows\System32\powershell.exe
#+END_SRC

*** Variable substrings
Fetches the last seven characters within the ~%COMSPEC%~ var:
#+BEGIN_SRC javascript
deobfuscate("%COMSPEC:~-7%"); // => cmd.exe
#+END_SRC

*** Escape-sequence stripping
All escape characters (~^~) are stripped from the command:
#+BEGIN_SRC javascript
deobfuscate("CmD /C p^o^w^e^r^s^h^e^l^l"); // => CmD /C powershell
#+END_SRC

*** Empty string removal
All empty strings are removed from the command:
#+BEGIN_SRC javascript
deobfuscate(`pow""ersh""ell`); // => powershell
#+END_SRC

** Reading Material

 - [[https://stackoverflow.com/questions/4094699/how-does-the-windows-command-interpreter-cmd-exe-parse-scripts][How does the Windows Command Interpreter (CMD.EXE) parse scripts?]]
 - [[https://msdn.microsoft.com/en-us/library/a1y7w461.aspx][WINAPI Parsing C Command-Line Arguments]]
 - [[https://blogs.msdn.microsoft.com/twistylittlepassagesallalike/2011/04/23/everyone-quotes-command-line-arguments-the-wrong-way/][Everyone quotes command line arguments the wrong way]]
 - [[https://blogs.msdn.microsoft.com/oldnewthing/20100917-00/?p=12833/][Whatâ€™s up with the strange treatment of quotation marks and backslashes by CommandLineToArgvW]]
 - [[https://www.dostips.com/?t=Snippets.Escape][DOS Tips: Escapes]]
 - [[https://docs.microsoft.com/en-gb/windows/desktop/api/shellapi/nf-shellapi-commandlinetoargvw][MSDN CommandLineToArgvW function]]
 - [[https://en.wikibooks.org/wiki/Windows_Batch_Scripting#How_a_command_line_is_interpreted][Windows Batch Scripting: Command Line Interpretation]]
 - [[https://ss64.com/nt/syntax-substring.html][DOS CMD Substrings]]
 - [[https://docs.microsoft.com/en-gb/windows/desktop/ProcThread/environment-variables][MSDN: Environment Variables]]
 - [[https://www.fireeye.com/blog/threat-research/2017/06/obfuscation-in-the-wild.html][FireEye: Obfuscation in the Wild]]
